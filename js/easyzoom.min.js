/**
 * Easy Zoom 1.0.2
 * 
 * Written by Matt Hinchliffe <http://www.github.com/i-like-robots/EasyZoom>
 * Based on the original work by Alen Grakalic <http://cssglobe.com/post/9711/jquery-plugin-easy-image-zoom>
 *
 * This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.
 * <http://creativecommons.org/licenses/by-sa/3.0/> 
 */
(function(a,b){function c(c,d){function t(){return f.ele={$target:a(c),$source:a("img",c),$parent:a(f.opts.parent),$loader:a(f.opts.loading),$panel:a('<div id="'+f.opts.id+'" />')},u(f.ele.$target.attr("href")),f.ele.$target.on("click",function(a){a.preventDefault()}).on("mouseenter",function(a){i=!0,x(a)}).on("mousemove",function(a){w(a)}).on("mouseleave",function(){f.hide(),i=!1}),f.opts.touch&&"ontouchstart"in document.documentElement&&(c.addEventListener("touchstart",function(a){a.touches.length===1&&(a.preventDefault(),i=!0,x(a))},!1),c.addEventListener("touchmove",function(a){a.touches.length===1?(a.preventDefault(),w(a)):f.ele.$target.trigger("mouseleave")},!1),c.addEventListener("touchend",function(){f.hide(),i=!1},!1)),f}function u(a){g=!1,f.ele.$target.css("cursor","progress"),f.ele.$loader.appendTo(f.ele.$target),f.ele.$zoomed=f.loadimg(a).on("error",function(){h=!1,v()}).on("load",function(){g=!0,f.ele.$target.css("cursor",f.opts.cursor),f.ele.$loader.detach(),f.ele.$panel.html(f.ele.$zoomed.css("position","absolute")),i&&f.ele.$target.trigger("mouseenter")})}function v(){f.ele.$panel.html(f.opts.error)}function w(a){a.type.indexOf("touch")===0?(j=a.touches[0].pageX,k=a.touches[0].pageY):(j=a.pageX||j,k=a.pageY||k);var b=f.ele.$source.offset(),c=j-b.left,d=k-b.top,e=c*r,g=d*s;e=e>n?n:e,g=g>q?q:g,e>0&&g>0&&f.ele.$zoomed.css({left:-e,top:-g})}function x(a){f.ele.$panel.parent().length===0&&f.ele.$panel.appendTo(f.ele.$parent).css("opacity",0),f.ele.$panel.stop().animate({opacity:1},200),l=f.ele.$source.width(),o=f.ele.$source.height(),m=f.ele.$panel.width(),p=f.ele.$panel.height(),n=f.ele.$zoomed.width()-m,q=f.ele.$zoomed.height()-p,r=n/l,s=q/o,w(a)}var e={id:"zoom-panel",parent:"body",error:'<p class="zoom-error">There has been a problem attempting to loading the image.</p>',loading:'<p class="fullsize-loading">Loading</p>',cursor:"crosshair",touch:!0};this.opts=a.extend({},e,d);var f=this,g=!1,h=!0,i=!1,j,k,l,m,n,o,p,q,r,s;return this.loadimg=function(b){var c=new Image;return c.src=b+"?"+(new Date).getTime(),c.onload=function(){c=null},a(c)},this.hide=function(){f.ele.$panel.parent().length&&f.ele.$panel.stop().animate({opacity:0},200,function(){f.ele.$panel=f.ele.$panel.detach()})},this.update=function(a){this.hide(),u(a)},c.tagName.toLowerCase()==="a"?t():b}a.fn.easyZoom=function(b){return this.each(function(){a.data(this,"easyZoom",new c(this,b))})},c.prototype.gallery=function(b,c){var d=this,e=c?a(c):this.ele.$parent;e.on("click",b,function(b){b.preventDefault();var c=a(this).addClass("thumbnail-loading"),e=c.attr("href"),f=c.data("easyzoomSource");d.loadimg(f).on("load",function(){d.ele.$source.attr("src",f),d.ele.$target.attr("href",e),d.update(e),c.removeClass("thumbnail-loading")})})}})(jQuery)